!function(){function t(t,h){this.mode=t||i,-1===e.indexOf(this.mode)&&(console.log('Butter has no mode called "'+this.mode+'".'),this.mode=i),this.threshold={black:-1e7,white:-6e6,bright:30},"undefined"!=typeof h&&null!==h&&(this.threshold[this.mode]=h)}var e=["black","bright","white"],i=e[0];t.prototype.sort=function(t,e){if(!t)throw"Butter needs a <canvas> to sort";var i=t.getContext("2d"),h=t.width,r=t.height,s=i.getImageData(0,0,h,r),o=this.sortImageData(s,h,r,e);i.putImageData(o,0,0)},t.prototype.sortImageData=function(t,e,i,h){this.imageData=t,this.width=e,this.height=i,h||(h=1);for(var r=0;h>r;r++){for(var s=0;s<this.width;s++)this.sortColumn(s);for(var o=0;o<this.height;o++)this.sortRow(o)}return this.imageData},t.prototype.setThreshold=function(t){this.threshold[this.mode]=t},t.prototype.sortColumn=function(t){for(var e,i,h,r=this.getRangesForColumn(t),s=0;s<r.length;s++){e=r[s],i=e.end-e.start,h=new Array(i);for(var o=0;i>o;o++)h[o]=this.getPixelValue(t,e.start+o);h.sort();for(var o=0;i>o;o++)this.setPixelValue(t,e.start+o,h[o])}},t.prototype.sortRow=function(t){for(var e,i,h,r=this.getRangesForRow(t),s=0;s<r.length;s++){e=r[s],i=e.end-e.start,h=new Array(i);for(var o=0;i>o;o++)h[o]=this.getPixelValue(e.start+o,t);h.sort();for(var o=0;i>o;o++)this.setPixelValue(e.start+o,t,h[o])}},t.prototype.getRangesForColumn=function(t){var e,i,h=[],r=0,s=0;switch(this.mode){case"black":e=this.getFirstNotBlackY,i=this.getNextBlackY;break;case"bright":e=this.getFirstBrightY,i=this.getNextDarkY;break;case"white":e=this.getFirstNotWhiteY,i=this.getNextWhiteY}for(;s<this.height&&(r=e.call(this,t,r),s=i.call(this,t,r),!(0>r||r>=this.height));r=s+1)h.push({start:r,end:s});return h},t.prototype.getRangesForRow=function(t){var e,i,h=[],r=0,s=0;switch(this.mode){case"black":e=this.getFirstNotBlackX,i=this.getNextBlackX;break;case"bright":e=this.getFirstBrightX,i=this.getNextDarkX;break;case"white":e=this.getFirstNotWhiteX,i=this.getNextWhiteX}for(;s<this.width&&(r=e.call(this,r,t),s=i.call(this,r,t),!(0>r||r>=this.width));r=s+1)h.push({start:r,end:s});return h},t.prototype.getFirstNotBlackX=function(t,e){for(;this.getPixelValue(t,e)<this.threshold.black;t++)if(t>=this.width)return-1;return t},t.prototype.getNextBlackX=function(t,e){for(t+=1;this.getPixelValue(t,e)>this.threshold.black;t++)if(t>=this.width)return this.width-1;return t},t.prototype.getFirstBrightX=function(t,e){for(;this.getPixelBrightness(t,e)<this.threshold.bright;t++)if(t>=this.width)return-1;return t},t.prototype.getNextDarkX=function(t,e){for(t+=1;this.getPixelBrightness(t,e)>this.threshold.bright;t++)if(t>=this.width)return this.width-1;return t},t.prototype.getFirstNotWhiteX=function(t,e){for(;this.getPixelValue(t,e)>this.threshold.white;t++)if(t>=this.width)return-1;return t},t.prototype.getNextWhiteX=function(t,e){for(t+=1;this.getPixelValue(t,e)<this.threshold.white;t++)if(t>=this.width)return this.width-1;return t},t.prototype.getFirstNotBlackY=function(t,e){for(;this.getPixelValue(t,e)<this.threshold.black;e++)if(e>=this.height)return-1;return e},t.prototype.getNextBlackY=function(t,e){for(e+=1;this.getPixelValue(t,e)>this.threshold.black;e++)if(e>=this.height)return this.height-1;return e},t.prototype.getFirstBrightY=function(t,e){for(;this.getPixelBrightness(t,e)<this.threshold.bright;e++)if(e>=this.height)return-1;return e},t.prototype.getNextDarkY=function(t,e){for(e+=1;this.getPixelBrightness(t,e)>this.threshold.bright;e++)if(e>=this.height)return this.height-1;return e},t.prototype.getFirstNotWhiteY=function(t,e){for(;this.getPixelValue(t,e)>this.threshold.white;e++)if(e>=this.height)return-1;return e},t.prototype.getNextWhiteY=function(t,e){for(e+=1;this.getPixelValue(t,e)<this.threshold.white;e++)if(e>=this.height)return this.height-1;return e},t.prototype.getPixelOffset=function(t,e){return 4*(t+e*this.width)},t.prototype.setPixelValue=function(t,e,i){var h=this.getPixelOffset(t,e),r=i>>16&255,s=i>>8&255,o=255&i,a=this.imageData.data;a[h]=r,a[h+1]=s,a[h+2]=o},t.prototype.getPixelValue=function(t,e){var i=this.getPixelOffset(t,e),h=this.imageData.data,r=h[i],s=h[i+1],o=h[i+2];return((65280|r)<<8|s)<<8|o},t.prototype.getPixelBrightness=function(t,e){var i=this.getPixelOffset(t,e),h=this.imageData.data,r=h[i],s=h[i+1],o=h[i+2];return Math.max(r,s,o)/255*100},"undefined"!=typeof module&&module.exports?module.exports=t:this.Butter=t}();